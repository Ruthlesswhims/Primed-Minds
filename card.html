<!DOCTYPE html>
<html>
	<head lang="en">
	    <meta charset="UTF-8">	
	    <meta name="viewport" content="width=device-width, initial-scale=1.0">

	    <title>Spot It Exploration</title>
			<!-- materialize css -->
			<link rel="stylesheet" type="text/css" href="stylesheets/materialize.min.css">

			
			<!-- fonts from gapis -->
			<link href="https://fonts.googleapis.com/css?family=Arima+Madurai:800" rel="stylesheet"> 
			<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet"> 
			<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Poppins:300">

			<!-- local css -->
			<link rel="stylesheet" type="text/css" href="stylesheets/card.css">
	</head>

	<body>
	    <!-- navbar code, copy code to top of body -->

	    <!-- dropdown structures -->
	    <ul id="dropdown-about" class="dropdown-content">
	        <li><a href="about.html#what is primed">What is Primed Minds?</a></li>
	        <li><a href="about.html#who for">Who is this for?</a></li>
	        <li><a href="about.html#philosophy">Philosophy</a></li>
	        <li><a href="about.html#what is math">What is mathematics anyway?</a></li>
	        <li><a href="#about.html#try exploration">How do I try an exploration?</a></li>       
	        <li><a href="about.html#team">The Team</a></li>
	        <li><a href="about.html#partners">Partners</a></li>
	    </ul>

	    <ul id="dropdown-explorations" class="dropdown-content">
	        <li><a href="card.html">Exploration 1</a></li>
	        <li><a href="#">Exploration 2</a></li>
	        <li><a href="#">Exploration 3</a></li>
	    </ul>

	    <!-- nav wrapper -->
	    <nav class="red">
            <div class="nav-wrapper">
                <a href="index.html"><img id="pom" src="assets/pom.png"></a>
                <a href="index.html" id="logo">PRIMED MINDS</a>

                <!-- right aligned navitems -->
                <ul class="right">
                        <!-- change 'active' class based on current page -->
                        <li class="active"><a href="index.html">Home</a></li>
                        <li><a class="dropdown-button" href="about.html" data-activates="dropdown-about">About</a></li>
                        <li><a class="dropdown-button" href="explorations.html" data-activates="dropdown-explorations">Explorations</a></li>
                        <li><a href="#">Resources</a></li>
                        <li><a href="contact.html">Q & A</a></li>
                    </li>
                </ul>
            </div>
        </nav>

		<div id="main">
			
			<div id="buttons">
			<button id="draw1">Draw Card</button> <button id="reset">Start Over</button>
			</div>

			<div class="container" id="images">
				<img class="monster" id="image blackPom" draggable="true" ondragstart="drag(event)" src="assets/blackPom.png">
				<img class="monster" id="image bwPom" image="bw" draggable="true" ondragstart="drag(event)" img src="assets/bwPom.png">
				<img class="monster" id="image bluePom" image="blue" draggable="true" ondragstart="drag(event)" img src="assets/bluePom.png">
				<img class="monster" id="image orangePom" image="orange" draggable="true" ondragstart="drag(event)" img src="assets/orangePom.png">
				<img class="monster" id="image purplePom" image="purple" draggable="true" ondragstart="drag(event)" img src="assets/purplePom.png">
				<img class="monster" id="image greenPom" image="green" draggable="true" ondragstart="drag(event)" img src="assets/greenPom.png">
				<img class="monster" id="image redPom" image="red" draggable="true" ondragstart="drag(event)" img src="assets/redPom.png">
			</div>
			
			<div class="container" id="cards">
				
			</div>
		   
		    <!--<footer>
		        &copy; Copyright 2016
		    </footer>-->
		</div>
		
	<!-- jquery js -->
	<script src="http://code.jquery.com/jquery-1.12.4.min.js"></script>
	
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>	

	<!-- materialize js -->
	<script src="public/javascript/materialize.min.js"></script>

	<!-- local js -->
	<script src="public/javascript/script.js"></script>
	
<!--	<script src="js/pixi.min.js"></script>-->
	
	<script src="js/card.js"></script>
	
<!--	<script src="js/dragging.js"></script>-->
	
	<script>
	function allowDrop(ev) {
	    ev.preventDefault();
	}

	function drag(ev) {
	    ev.dataTransfer.setData("text", ev.target.id);
	}

	function drop(ev) {
	    ev.preventDefault();
	    var data = ev.dataTransfer.getData("text");
	    var nodeCopy = document.getElementById(data).cloneNode(true);
	    console.log(data);
  		if (ev.target.childNodes.length < 3) {
  			ev.target.appendChild(nodeCopy);
  			var index = findCardIndex(ev.target.id);
  			console.log(index);
  			var existingNum = cards[index].images.get(data);
  			if (existingNum == null) {
  				existingNum = 0;
  			}
  			cards[index].images.set(data, existingNum+1);
  			console.log(existingNum+1);
  			console.log("length of card " + index + " is :" + cards[index].images.size)
  			validateCards(index);
  			colorCards();	
  		}
	}

	// Array of cards (objects).
	var cards = [];

	// Create 8 cards & push to array of cards.
	for(var i = 0; i < 8; i++){
	  // Temporary object
	  var tempCard = {
	    // Each card gets a name: card0, card1, etc.
	    name: 'card' + i,
	    // By default, each card is invalid (red).
	    valid: false,
	    // At the start, cards don't have any images.
	    // imageName: numPresent,
	    images: new Map(),
	  }

      // Add temp card to array of cards.
      cards.push(tempCard);
	}

	/*
	 * Find index of a card in 'cards' array based on its name.
	 * Returns -1 if card is not found.
	 * Returns card index (in this case 0 - 6) if found.
	 */
	function findCardIndex(cardName) {
		// Set index to -1 (not found) by default. If found, we'll overwrite this.
		var index = -1;

		// Iterate through all the cards.
		for(var i = 0; i < cards.length; i++){
	          if (cards[i].name == cardName) {
	              // Card name found. Set index & end looop.
	              index = i;
	              break;
	          }
		}

	        return index;
	} /*END findCardIndex()*/

	/* Compare all cards to just updated card */ 
	function validateCards(index) {
		console.log("validating");
		var found = false;
		for(var i = 0; i< cards.length; i++) {
			// do not compare to itself 
			if (index != i) {
				for(var j=0; j<cards[i].images.size; j++) {
					if ( cards[i].images.size == cards[index].images.size) {
						console.log("lengths equal in cards " + index + " and " + i);
						var valid = true;
						for(var image in cards[index].images) {
							var num = cards[i].images.get(image);
							console.log("found: " + image + " x" + num + " in " + i);
							if (num == null || num != cards[i].images.get(image)) {
								console.log(image + " not found in card " + i);
								valid = false;
							}
						}
						if (valid) {
							console.log("found pair: " + i + ", " + index);
							found = true;
							cards[i].valid = true;
							cards[index].valid = true;
						} else {
							cards[i].valid = false;
						}
					} else {
						// cards[i].valid = false;
					}					
				}
			}
		}
		if (!found) {
			cards[index].valid = false;
		}
	}

	function colorCards() {
		console.log("coloring");
		for(var i=0; i<cards.length; i++) {
			if (cards[i].valid) {
				console.log("card " + i + " is true");
				document.getElementById(cards[i].name).style.backgroundColor = "#5fb962";
			} else {
				document.getElementById(cards[i].name).style.backgroundColor = "#ffdd54";
			}
		}
	}
	</script>

	</body>
</html>